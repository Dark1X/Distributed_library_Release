<html>
<head>
	<title>BookSwop | free book swap platform</title>

    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
    <link rel="shortcut icon" type="image/png" href="@routes.Assets.versioned("images/favicon.png")">
	<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/bootstrap.css")">
	<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/style.css")">

    <script src="@routes.Assets.versioned("javascripts/jquery.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/bootstrap.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/modernizr.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/isotope.pkgd.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/jquery.backstretch.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/jquery.appear.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/template.js")" type="text/javascript"></script>
    <style type="text/css">
        body{
            background:url("/assets/images/timg.jpg");
            position:absolute; 
            top:0; 
            left:0; 
            height:100%; 
            width:100%; 
            background-position: center 0; 
            background-repeat: no-repeat; 
            background-attachment:fixed; 
            background-size: cover; 
            -webkit-background-size: cover;
            -o-background-size: cover;
            zoom: 1; 
            min-width: 600px;
            min-height: 400px;
        }
    </style>    
</head>

<body nonce=cXdhZGFkemNhd2R3ZA== style="min-width: 1080px; min-height: 850px; " >
    <header class="header fixed clearfix navbar navbar-fixed-top">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="header-left clearfix"><a href="@routes.Application.main">
                        <div class="logo smooth-scroll">
                          <div id="logo"><img src="@routes.Assets.versioned("images/logo.png")" nonce=cXdhZGFkemNhd2R3ZA== style="max-width:60px;height: auto;"  alt="BookSwop"></div>
                        </div>
                        <div class="site-name-and-slogan smooth-scroll">
                            <div class="site-name" nonce=cXdhZGFkemNhd2R3ZA== style="color: white"><a href="#banner">BookSwop</a></div>
                            <div class="site-slogan " nonce=cXdhZGFkemNhd2R3ZA== style="color: white">Free Book Swap Platform</div>
                        </div>
                    </div>
                </a></div>
                <div class="col-md-8">
                    <div class="header-right clearfix">
                        <div class="main-navigation animated">
                            <nav class="navbar navbar-default" role="navigation">
                                <div class="container-fluid">
                                    <div class="navbar-header">
                                        <div onclick="jumpp()" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                                            <span class="sr-only">Toggle navigation</span>
                                            <span class="icon-bar"></span>
                                            <span class="icon-bar"></span>
                                            <span class="icon-bar"></span>
                                        </div>

                                    </div>

                                    <!-- Collect the nav links, forms, and other content for toggling -->
                                    <div class="collapse navbar-collapse scrollspy smooth-scroll" id="navbar-collapse-1">
                                        <ul class="nav navbar-nav navbar-right">
                                            <li><a href="@routes.Application.main">Home</a></li>
                                            <li><a  href="@routes.Application.logIn">Log in</a></li>
                                            <li class="active"><a  href="@routes.Application.signUp">Sign up</a></li>
																						<li><a href="@routes.Application.aboutUs">About us</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </nav>
                            <!-- navbar end -->
                        </div>
                        <!-- main-navigation end -->
                    </div>
                    <!-- header-right end -->
                </div>
            </div>
        </div>
    </header>

	<div id="banner" class="banner">
		<div class="banner-caption-signup">
		<div id="space"></div>
	    <form id="information">
		<table>
					<td colspan="2" style="padding-left: 180px; font-size: 40px; padding-bottom: 30px;"><b>Sign Up</b></td>
		<tr>
			<td><h2>Name: </h2></td>
			<td><input nonce=cXdhZGFkemNhd2R3ZA== style="width:210px; " id="name" type="text" onblur="checkName(this)"></td>
			<td id="nameout" nonce=cXdhZGFkemNhd2R3ZA== style="color: #c00;width:300px"></td>
		</tr>
		<tr>
			<td><h2>Email Address: </h2></td>
			<td><input nonce=cXdhZGFkemNhd2R3ZA== style="width:210px" id="email" type="text" onblur="checkEmail(this)"> .ac.uk</td>
			<td id="emailout" nonce=cXdhZGFkemNhd2R3ZA== style="color: #c00;"></td>
		</tr>
		<tr>
			<td><h2>Date of Birth: </h2></td>
			<td>
                <input id="day" nonce=cXdhZGFkemNhd2R3ZA== style="width:60px; " type="text" size="2" maxlength="2" placeholder="DD" onkeyup="nextTxt(this,1)" onkeydown="onlyNum();" onblur="getDay()">&nbsp;
                <input id="month" nonce=cXdhZGFkemNhd2R3ZA== style="width:60px" type="text" size="2" maxlength="2" placeholder="MM" onkeyup="nextTxt(this,2)" onkeydown="onlyNum();" onblur="getMonth()">&nbsp;
                <input id="year" nonce=cXdhZGFkemNhd2R3ZA== style="width:70px" type="text" size="4" maxlength="4" placeholder="YYYY" onkeyup="nextTxt(this,3)" onkeydown="onlyNum();" onblur="getYear()">
			</td>
			<td id="birthout" nonce=cXdhZGFkemNhd2R3ZA== style="color: #c00;"></td>
		</tr>

		<tr>
			<td><h2>Password: </h2></td>
			<td><input nonce=cXdhZGFkemNhd2R3ZA== style="width:210px" id="password" name="password" type="password" onblur="checkPassword(this)"></td>
			<td id="passwordout" nonce=cXdhZGFkemNhd2R3ZA== style="color: #c00;"></td>
		</tr>
		<tr>
			<td><h2>Confirm Password: </h2></td>
			<td><input nonce=cXdhZGFkemNhd2R3ZA== style="width:210px" id="confirm_password" type="password" onblur="confirmPassword(this, password)"></td>
			<td id="confirmout" nonce=cXdhZGFkemNhd2R3ZA== style="color: #c00;"></td>
		</tr>

		<tr>
		<td colspan="3" nonce=cXdhZGFkemNhd2R3ZA== style="padding-left: 50px;" ><label><input id="accept"  type="checkbox" nonce=cXdhZGFkemNhd2R3ZA== style="vertical-align:middle;"> Accept the <a  target="_blank" href="@routes.Application.termsOfService">Terms of Service</a> and the <a  target="_blank" href="@routes.Application.privacyPolicy">Privacy Policy</a>.</label></td>
		</tr>
		<tr>
		<td colspan="2" nonce=cXdhZGFkemNhd2R3ZA== style="padding-left: 180px; "><button id="signUp" nonce=cXdhZGFkemNhd2R3ZA== style="width:150px; outline: none;" onclick="jump()" type="button">Submit</button></td>
		</tr>
		<tr><td colspan="2" id="buttonout" nonce=cXdhZGFkemNhd2R3ZA== style="color: #c00;"></td></tr>
	</table>
    </form>
	</div>
	</div>

<script nonce=cXdhZGFkemNhd2R3ZA==>
var day, month, year;
var mon1 = [1,3,5,7,8,10,12];
var mon2 = [4,6,9,11];
var birth = document.getElementById('birthout');
var nameTrue = false;
var emailTrue = false;
var dateTrue = false;
var passwordTrue = false;
var acceptTrue = false;
var confirmPasswordTrue = false;

function jump()
{
	localStorage.clear();
	checkPassword(document.getElementById('password'));
	checkEmail(document.getElementById('email'));
	checkName(document.getElementById('name'));
	confirmPassword(document.getElementById('password'), document.getElementById('confirm_password'))
	checkAccept();
	var button = document.getElementById('buttonout');
	if (nameTrue == true && emailTrue == true && dateTrue == true && confirmPasswordTrue == true&& passwordTrue == true && acceptTrue == true){
		var nameText = document.getElementById('name').value.toString();
		var emailText = document.getElementById('email').value.toString();
		emailText = emailText +".ac.uk";
		var passwordText = document.getElementById('password').value.toString();
		var verify = document.getElementById('confirm_password').value.toString();
		var jsonData = {"name":nameText,"email":emailText,"confirm_email":emailText,"password":passwordText,"confirm_password":verify,"year":year,"month":month,"day":day};
		var xhr = new XMLHttpRequest();
		xhr.open("POST",'/v1/users/user',true);
		xhr.setRequestHeader('content-type', 'application/json');
		xhr.send(JSON.stringify(jsonData));
		xhr.onreadystatechange = function(){
			if (xhr.readyState == 4 ) {
				if(xhr.status == 200){
					var myArr = JSON.parse(this.responseText);
					if (window.localStorage) {
						try {
							localStorage.setItem('_uid', myArr.id);
							localStorage.setItem('_name', nameText);
							localStorage.setItem('_email', emailText);
							setTimeout("javascript:location.href='/welcome'", 100);
						} catch (e) {
							if (e.name === 'QUOTA_EXCEEDED_ERR' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
								alert("Sorry, Cannot storage infomation on this devices, because the device storage is full. Please Check your browser and try later on. Error Code: CT0001");
							} else {
								alert("Unknow Error. Please try later on. Error Code: CT9999");
							}
						}
					}
				}else{
					button.style.color = "red";
					button.innerHTML = this.responseText;
			 }
			}
		}
	}
}

function checkBirth()
{
	if (day>0 && year>1900 && year<2001){
		if (month == 1 || month == 3 || month == 5 || month == 7 || month == 8 || month == 10 || month == 12 ){
			if (day<32){
				validBirth = true;
			}
		}
		else if (month == 4 || month == 6 || month == 9 || month == 11){
			if (day<31){
				validBirth = true;
			}
		}
		else if (month == 2){
			if (year % 100 == 0){
				if (year % 400 == 0){
					if (day<30) validBirth = true;
				} else{
					if (day<29) validBirth = true;
				}
			} else{
				if (year % 4 == 0){
					if (day<30) validBirth = true;
				} else{
					if (day<29) validBirth = true;
				}
			}
		}
	}
	if(validBirth==true){
			birth.style.color = "green";
			birth.innerHTML = "✔";
	}
}

function getDay()
{
	validBirth = false;
	day = document.getElementById('day').value;
	if (day.length == 1){
		day = '0' + day;
	}
	document.getElementById('day').value = day;
	if (day == "" || month == "" || year == ""){
		birth.style.color = "red";
		birth.innerHTML = "Date of birth can't be blank";
	} else if (day !== undefined && month !== undefined && year !== undefined){
		checkBirth();
		if (validBirth == true){
			birth.innerHTML = "";
		} else {
			birth.style.color = "red";
			birth.innerHTML = "Date of birth is invalid";}
	}
}

function getMonth()
{
	validBirth = false;
	month = document.getElementById('month').value;
	if (month.length == 1){
		month = '0' + month;
	}
	document.getElementById('month').value = month;
	if (day == "" || month == "" || year == ""){
		birth.style.color = "red";
		birth.innerHTML = "Date of birth can't be blank";
	} else if (day !== undefined && month !== undefined && year !== undefined){
		checkBirth();
		if (validBirth == true){
			birth.innerHTML = "";
		} else {
			birth.style.color = "red";
			birth.innerHTML = "Date of birth is invalid"};
	}
}

function getYear()
{
	validBirth = false;
	year = document.getElementById('year').value;
	if (day == "" || month == "" || year == ""){
		birth.style.color = "red";
		birth.innerHTML = "Date of birth can't be blank";
	} else if (day !== undefined && month !== undefined && year !== undefined){
		checkBirth();
		if (validBirth == true){
			birth.style.color = "green";
			birth.innerHTML = "✔";
			dateTrue = true;
		} else {
			birth.style.color = "red";
			birth.innerHTML = "Date of birth is invalid"};
	}

}

function onlyNum()
{
	if(!(event.keyCode==46)&&!(event.keyCode==8)&&!(event.keyCode==37)&&!(event.keyCode==39))
	if(!((event.keyCode>=48&&event.keyCode<=57)||(event.keyCode>=96&&event.keyCode<=105)))
	event.returnValue=false;
}

function nextTxt(object, number)
{
   	if (object.value.length == 2 && number == 1) {
        document.getElementById("information").elements[3].focus();
	}
	else if (object.value.length == 2 && number == 2) {
		document.getElementById("information").elements[4].focus();
	}
	else if (object.value.length == 4 && number == 3) {
		document.getElementById("information").elements[5].focus();
	}
}

function checkName(nameTxt)
{
	var validName = true;
	var name = document.getElementById('nameout');
	if(nameTxt.value==""){
		name.style.color = "red";
		name.innerHTML = "Name can't be blank";
	}
	else if(nameTxt.value.length<3){
		name.style.color = "red";
		name.innerHTML = "Name is too short(minimum is 3 characters)";
	}
	else if(nameTxt.value.length>50){
		name.style.color = "red";
		name.innerHTML = "Name is too long(maxmum is 50 characters)";
	}
	else {
		for (var i = 0; i < nameTxt.value.length; i++){
			if (nameTxt.value.charCodeAt(i)<48 || (nameTxt.value.charCodeAt(i)>57 && nameTxt.value.charCodeAt(i)<65) || (nameTxt.value.charCodeAt(i)>90 && nameTxt.value.charCodeAt(i)<97) || nameTxt.value.charCodeAt(i)>122)
				validName = false;
		}
		if (validName == false) {
			name.style.color = "red";
			name.innerHTML = "Name only allows numbers and letters";}
		else {
			name.style.color = "green";
			name.innerHTML = "✔";
			nameTrue = true;
		}
	}
}

function checkAccept()
{
	var button = document.getElementById('buttonout');
	if (document.getElementById('accept').checked == true){
		acceptTrue = true;
	}else{
		button.style.color = "red";
		button.innerHTML = "To continue, You have to accept our teams and conditions.";
	}
}

function checkPassword(passwordTxt)
{
	 var password = document.getElementById('passwordout');
	if(passwordTxt.value==""){
		password.style.color = "red";
		password.innerHTML = "Password can't be blank";
	}
	else if(passwordTxt.value.length<8){
		password.style.color = "red";
		password.innerHTML = "Password is too short (minimum is 8 characters)";
	}
	else if(passwordTxt.value.length>18){
		password.style.color = "red";
		password.innerHTML = "Password is too long (maxmum is 18 characters)";
	}
	else {
			password.style.color = "green";
			password.innerHTML = "✔";
			passwordTrue = true;
	}
}

String.prototype.endsWith = function (s) {
  return this.length >= s.length && this.substr(this.length - s.length) == s;
}

function isEmail(str) {
  var pattern = /^\w+([\.-]?\w+)*@@\w+([\.-]?\w+)*$/;
	return pattern.test(str);
}

function checkEmail(emailTxt)
{
	 var email = document.getElementById('emailout');
	if(emailTxt.value=="" || emailTxt.value.indexOf('@@')==-1 || emailTxt.value.length>255|| isEmail(emailTxt.value)==false){
		email.style.color = "red";
		email.innerHTML = "Email is invalid";
	}else if(emailTxt.value.toString().toLowerCase().endsWith(".ac.uk")){
		email.style.color = "red";
		email.innerHTML = "Do not need input '.ac.uk'";
	}
	else {
		email.style.color = "green";
		email.innerHTML = "✔";
		emailTrue = true;
	}
}

function confirmPassword(passwordTxt, newPassword)
{
    var password = document.getElementById('confirmout');

	if(passwordTxt.value !== newPassword.value){
				password.style.color = "red";
        password.innerHTML = "Password doesn't match the confirmation";
    }else if(passwordTrue==false){
			password.style.color = "red";
			password.innerHTML = "Please check your password";
		}
    else {
						password.style.color = "green";
            password.innerHTML = "✔";
            confirmPasswordTrue = true;
    }
}

    var i=0;
    function jumpp()
    {
        var space = document.getElementById('space');
        var logo = document.getElementById('logo');
        if (i === 0){
             space.innerHTML = "<br><br><br><br><br><br><br>";
             logo.innerHTML = "";
             i = 1;
         } else {
            space.innerHTML = "";
            logo.innerHTML = "<a ><img  src='@routes.Assets.versioned("images/logo.png")'' style='max-width:60px;height: auto;'  alt='BookSwop'></a>";
            i = 0;
         }

    }
</script>

</body>
</html>
